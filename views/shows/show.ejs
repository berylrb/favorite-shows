<%- include('../partials/html-head') %>
  <link rel="stylesheet" href="/stylesheets/shows/show.css" />
  <%- include('../partials/nav') %>

    <main>

      <div class="show-details-page">

        <div class="show-info-div">

          <div class="poster-desc-div">
            <div class="poster-container">
              <% if (apiResult.poster_path) { %>
                <img class="poster" src="https://image.tmdb.org/t/p/original/<%= apiResult.poster_path %>" alt="">
                <% } else { %>
                  <img class="poster"
                    src="https://images-we-got-pop.imgix.net/website/marketing/movie-placeholder.png?w=300&h=450&fit=clamp&auto=format,compress"
                    alt="">
                  <% } %>
            </div>


            <div class="header-description">
              <div class="header-tagline-div">
                <div class="show-h1-div">
                  <h1 class="show-name">
                    <%= apiResult.name %>
                  </h1>
                </div>
                <% if (apiResult.tagline) { %>
                  <!-- <div class="tagline-div"> -->
                  <h4 class="tagline-h2">
                    <%= apiResult.tagline %>
                  </h4>
                  <!-- </div> -->

                  <% } %>
              </div>
              <p class="rating-p">RATING: <%= apiResult.vote_average %>
              </p>
              <div class="description">
                <p class="overview-p">
                  <%= apiResult.overview %>
                </p>
              </div>

            </div>

          </div>

          <div class="watch-recs-div">
            <% if (apiResult.number_of_seasons) { %>
              <div class="seasons-div">
                <h2 class="number-szns">
                  Number of seasons:
                </h2>
                <p class="season-p">
                  <%= apiResult.number_of_seasons %>
                </p>

              </div>

              <% } %>
            <% if (apiResult.homepage) { %>
              <div class="link-to-show">
                <h3 class="link-to-show-h2">
                  Watch <%= apiResult.name %> <a href="<%= apiResult.homepage %>">here</a>
                </h3>
              </div>
              <% } %>
                <div class="recs-div">
                  <a class="text-black" href="/shows/<%= apiResult.id %>/recommended">Discover reccommendations
                    based on
                    <%= apiResult.name %>
                  </a>
                </div>
          </div>
        </div>




        <div class="delete-btn">
          <% if (userHasShow) { %>
            <div class="remove-div">
              <p class="remove-p">
                <%= apiResult.name %> is already in your collection.
              </p>
            </div>
            <form class="text-center" action="/shows/<%= apiResult.id %>/removeFromCollection?_method=PATCH"
              method="POST">
              <button class="button-31 btn-danger">
                Remove From Collection
              </button>
            </form>
        </div>
        <% } %>

          <div class="second-section">
            <% if (show?.collectedBy.length> 0) { %>
              <div class="accordion" id="accordion">
                <div class="accordion-item bg-dark">
                  <h2 class="accordion-header" id="headingTwo">
                    This show appears in <%= show?.collectedBy.length %> user Queues:
                  </h2>
                  <div class="all-collectors">
                    <% show?.collectedBy.forEach(profile=> { %>
                      <div class="collector">
                        <a class="text-white" href="/profiles/<%= profile._id %>" class="text-white">
                          <p class="white-text">
                            <img src="<%= profile.avatar %>" alt="<%= profile.name %>'s avatar"
                              class="me-3 rounded-circle" width="50px" height="50px">
                            <br>
                            <%= profile.name %>
                          </p>
                        </a>
                      </div>
                      <% }) %>
                  </div>
                </div>
              </div>
          </div>
          <% } %>

            <% if (!userHasShow) { %>
              <form class="text-center" action="/shows/<%= apiResult.id %>/addToCollection?_method=PATCH" method="POST">
                <input type="text" name="name" hidden value="<%= apiResult.name %>">
                <input type="text" name="mdbId" hidden value="<%= apiResult.id %>">
                <input type="text" name="imageUrl" hidden
                  value="https://image.tmdb.org/t/p/original/<%= apiResult.poster_path %>">
                <button class="button-31 btn-primary">
                  Add To Collection
                </button>
              </form>
              <% } %>

                <br>
                <br>
                <div class="container">
                  <% if (!userHasReviewed && userHasShow) { %>
                    <form class="review-form" action="/reviews/<%= show._id %>" method="POST">
                      <div class="mb-3 mt-4">
                        <label for="exampleFormControlTextarea1" class="form-label text-light">
                          Leave a review:
                        </label>
                        <select name="rating" class="form-select">
                          <option value="1">1 ⭐</option>
                          <option value="2">2 ⭐</option>
                          <option value="3">3 ⭐</option>
                          <option value="4">4 ⭐</option>
                          <option value="5">5 ⭐</option>
                        </select>
                        <textarea name="content" class="form-control" id="exampleFormControlTextarea1"
                          rows="3"></textarea>
                      </div>
                      <button class="button-32 btn-warning" type="submit">Add Review</button>
                    </form>
                    <% } %>


                      <% if (show?.reviews.length) { %>
                        <h2 class="text-light my-3">Reviews:</h2>
                        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g1 px-4">
                          <div class="review-wrapper">
                            <% show.reviews.forEach(review=> { %>
                              <div class="col">
                                <div class="card mb-3 bg-secondary">
                                  <div class="row g-0">

                                    <div class="col-3">
                                      <img src="<%= review.author.avatar %>" class="img-fluid rounded-circle ms-2 mt-2"
                                        alt="<%= review.author.name %>'s avatar">
                                    </div>
                                    <div class="col-9">
                                      <div class="card-body">
                                        <h3 class="card-title text-dark">
                                          <a class="text-dark text-decoration-none"
                                            href="/profiles/<%= review.author._id %>">
                                            <%= review.author.name %>
                                          </a>
                                        </h3>
                                        <p class="card-text text-dark">
                                          <%= "⭐" .repeat(review.rating) %>
                                        </p>
                                        <p class="card-text text-dark">
                                          <%= review.content %>
                                        </p>
                                      </div>
                                    </div>
                                  </div>

                                </div>
                              </div>
                              <% }) %>
                          </div>
                          <% } %>

                        </div>
                </div>

                <br>
                <br>


                <br>
                <br>
      </div>
    </main>

    <%- include('../partials/footer') %>